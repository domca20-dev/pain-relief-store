<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="theme-color" content="#1a1a2e">

  <title>
    {{ page_title }}
    {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
    {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
    {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
  </title>

  {%- if page_description -%}
    <meta name="description" content="{{ page_description | escape }}">
  {%- endif -%}

  {%- render 'meta-tags' -%}

  <link rel="canonical" href="{{ canonical_url }}">
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>

  {%- comment -%} System fonts for speed — no external font downloads {%- endcomment -%}
  <style>
    :root {
      --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --color-primary: #1a1a2e;
      --color-accent: #2ecc71;
      --color-bg: #ffffff;
      --color-text: #333333;
      --color-sale: #e74c3c;
    }
    body {
      font-family: var(--font-body);
      color: var(--color-text);
      background: var(--color-bg);
      margin: 0;
      padding: 0;
      font-size: 16px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>

  {{ 'custom-product-page.css' | asset_url | stylesheet_tag }}
  {{ 'policy-pages.css' | asset_url | stylesheet_tag }}

  {{ content_for_header }}

  {%- comment -%}
    Meta Pixel base code — replace YOUR_PIXEL_ID with your actual Meta Pixel ID.
  {%- endcomment -%}
  <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
    document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', 'YOUR_PIXEL_ID');
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=YOUR_PIXEL_ID&ev=PageView&noscript=1" />
  </noscript>

  {%- comment -%} Meta Pixel — ViewContent event on product pages {%- endcomment -%}
  {%- if template.name == 'product' -%}
    <script>
      fbq('track', 'ViewContent', {
        content_name: {{ product.title | json }},
        content_ids: [{{ product.selected_or_first_available_variant.id | json }}],
        content_type: 'product',
        value: {{ product.selected_or_first_available_variant.price | money_without_currency | remove: ',' }},
        currency: {{ cart.currency.iso_code | json }}
      });
    </script>
  {%- endif -%}
</head>

<body class="template-{{ template.name }}{% if template.suffix %} template-{{ template.name }}-{{ template.suffix }}{% endif %}">
  <a class="skip-to-content-link visually-hidden" href="#MainContent">
    {{ "accessibility.skip_to_text" | t }}
  </a>

  {%- sections 'header-group' -%}

  <main id="MainContent" class="content-for-layout" role="main" tabindex="-1">
    {{ content_for_layout }}
  </main>

  {%- sections 'footer-group' -%}

  <script>
    // Lazy image loading fallback
    if ('loading' in HTMLImageElement.prototype === false) {
      var lazyImages = document.querySelectorAll('img[loading="lazy"]');
      lazyImages.forEach(function(img) {
        img.src = img.src;
      });
    }
  </script>

  {%- comment -%} Meta Pixel — AddToCart event listener {%- endcomment -%}
  {%- if template.name == 'product' -%}
    <script>
      (function() {
        document.addEventListener('click', function(e) {
          var btn = e.target.closest('[type="submit"][name="add"], .product-hero__add-btn, .final-cta__add-btn');
          if (btn) {
            fbq('track', 'AddToCart', {
              content_name: {{ product.title | json }},
              content_ids: [{{ product.selected_or_first_available_variant.id | json }}],
              content_type: 'product',
              value: {{ product.selected_or_first_available_variant.price | money_without_currency | remove: ',' }},
              currency: {{ cart.currency.iso_code | json }}
            });
          }
        });
      })();
    </script>
  {%- endif -%}

  {%- comment -%} Meta Pixel — InitiateCheckout event {%- endcomment -%}
  {%- if template.name == 'cart' or request.page_type == 'cart' -%}
    <script>
      fbq('track', 'InitiateCheckout', {
        content_ids: [{% for item in cart.items %}"{{ item.variant_id }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
        content_type: 'product',
        num_items: {{ cart.item_count }},
        value: {{ cart.total_price | money_without_currency | remove: ',' }},
        currency: {{ cart.currency.iso_code | json }}
      });
    </script>
  {%- endif -%}

  {%- comment -%}
    Meta Pixel — Purchase event
    This fires on the Shopify thank-you / order confirmation page.
    Shopify's checkout pages handle the pixel via the "Additional scripts" setting
    (Settings > Checkout > Order status page > Additional scripts).
    Paste the following in that field to track purchases:

    <script>
      if (typeof fbq !== 'undefined') {
        fbq('track', 'Purchase', {
          content_ids: [{% for line_item in order.line_items %}'{{ line_item.variant.id }}'{% unless forloop.last %},{% endunless %}{% endfor %}],
          content_type: 'product',
          num_items: {{ order.line_items.size }},
          value: {{ order.subtotal_price | money_without_currency | remove: ',' }},
          currency: '{{ order.currency }}'
        });
      }
    </script>
  {%- endcomment -%}
</body>
</html>
